# Spring application "Bonus server".

## 1. Create database.

В качестве сервера бд в моем случае выступал докер контейнер MySql.
Скачать его образ можно с докер хаба с помощью следующей команды: `docker pull mysql`.

В файле docker-compose.yml описаны все инструкции, необходимые для настройки и запуска бд. Запустите `docker-compose up -d`.

В случае использования другого сервера бд или использования других настроек подключения, необходимо изменить параметры **_spring.datasource...._** в файле **application.properties**.  
  
Скрипты по созданию и заполнению дефолт-значениями таблиц лежат в папке [migration](src%2Fmain%2Fresources%2Fdb%2Fmigration)  

#### Используемые индексы:  
1) Для таблицы cards: Индекс по столбцу number, так как часто идет поиск карты по номеру.
2) Для таблицы transactions: Индекс по столбцу card_id, так как часто извлекаются транзакции, связанные с конкретной картой

## 2. Rest
### Зачисление на Карту
- **URL:** `/api/credit`
- **Метод:** `POST`
- **Описание:** Зачисляет указанную сумму на карту по её номеру.
- **Параметры запроса:**
    - `cardNumber` (обязательный): Номер карты для зачисления.
    - `amount` (обязательный): Сумма для зачисления.
- **Успешный ответ:**
    - **Код:** 201 CREATED
    - **Содержимое:** Объект `TransactionDTO`, представляющий выполненную транзакцию.
- **Ответ при ошибке:**
    - **Код:** 400 BAD REQUEST
    - **Содержимое:** Сообщение об ошибке в случае неудачи.

### Списание с Карты

- **URL:** `/api/debit`
- **Метод:** `POST`
- **Описание:** Списывает указанную сумму с карты по её номеру.
- **Параметры запроса:**
    - `cardNumber` (обязательный): Номер карты для списания.
    - `amount` (обязательный): Сумма для списания.
- **Успешный ответ:**
    - **Код:** 200 OK
    - **Содержимое:** Объект `TransactionDTO`, представляющий выполненную транзакцию.
- **Ответ при ошибке:**
    - **Код:** 400 BAD REQUEST
    - **Содержимое:** Сообщение об ошибке в случае неудачи.

### Возврат Транзакции

- **URL:** `/api/refund`
- **Метод:** `POST`
- **Описание:** Возвращает средства по конкретной транзакции.
- **Параметры запроса:**
    - `transactionId` (обязательный): ID транзакции для возврата.
- **Успешный ответ:**
    - **Код:** 200 OK
    - **Содержимое:** Объект `TransactionDTO`, представляющий возвращенную транзакцию.
- **Ответ при ошибке:**
    - **Код:** 400 BAD REQUEST
    - **Содержимое:** Сообщение об ошибке в случае неудачи.

### Получение Баланса Карты

- **URL:** `/api/balance/{cardNumber}`
- **Метод:** `GET`
- **Описание:** Возвращает баланс указанной карты по её номеру.
- **Параметры URL:**
    - `cardNumber` (обязательный): Номер карты.
- **Успешный ответ:**
    - **Код:** 200 OK
    - **Содержимое:** Баланс карты в виде `BigDecimal`.
- **Ответ при ошибке:**
    - **Код:** 404 NOT FOUND
    - **Содержимое:** Сообщение об ошибке, если карта не найдена.

### Получение Истории Транзакций по Номеру Карты

- **URL:** `/api/transactions/{cardNumber}`
- **Метод:** `GET`
- **Описание:** Возвращает историю транзакций для указанной карты по её номеру.
- **Параметры URL:**
    - `cardNumber` (обязательный): Номер карты.
- **Успешный ответ:**
    - **Код:** 200 OK
    - **Содержимое:** Список объектов `TransactionDTO`, представляющих историю транзакций карты.
- **Ответ при ошибке:**
    - **Код:** 404 NOT FOUND
    - **Содержимое:** Сообщение об ошибке, если карта не найдена.  
   
## Авторизация
Для get методов был подготовлен пользователь reader с паролем 1  
Для post методов был подготовлен пользователь writer с паролем 2